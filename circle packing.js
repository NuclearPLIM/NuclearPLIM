var root = {
  "name": "Table",
  "children": [
    {
      "name": "Other",
      "children": [
        {
          "name": "Argentina",
          "children": [
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Atucha",
                  "size": 1033,
                  "age": 49.0
                },
                {
                  "name": "Embalse",
                  "size": 608,
                  "age": 39.8
                }
              ]
            }
          ]
        },
        {
          "name": "Brazil",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Angra-1",
                  "size": 609,
                  "age": 40.8
                },
                {
                  "name": "Angra-2",
                  "size": 1275,
                  "age": 22.5
                }
              ]
            }
          ]
        },
        {
          "name": "Mexico",
          "children": [
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Laguna Verde",
                  "size": 1552,
                  "age": 34.2
                }
              ]
            }
          ]
        },
        {
          "name": "South Africa",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Koeberg",
                  "size": 1854,
                  "age": 38.8
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Asia",
      "children": [
        {
          "name": "Armenia",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Armenia",
                  "size": 448,
                  "age": 43.0
                }
              ]
            }
          ]
        },
        {
          "name": "China",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Chang Jiang",
                  "size": 1202,
                  "age": 8.2
                },
                {
                  "name": "Fangchenggang",
                  "size": 2000,
                  "age": 7.2
                },
                {
                  "name": "Fuqing",
                  "size": 5075,
                  "age": 7.2
                },
                {
                  "name": "Guangdong",
                  "size": 1888,
                  "age": 8.4
                },
                {
                  "name": "Haiyang",
                  "size": 2340,
                  "age": 29.4
                },
                {
                  "name": "Hongyanhe",
                  "size": 5305,
                  "age": 4.4
                },
                {
                  "name": "Ling Ao",
                  "size": 1900,
                  "age": 10.0
                },
                {
                  "name": "Ling Ao Ii",
                  "size": 2014,
                  "age": 20.9
                },
                {
                  "name": "Ningde",
                  "size": 4072,
                  "age": 12.6
                },
                {
                  "name": "Qinshan",
                  "size": 6144,
                  "age": 10.1
                },
                {
                  "name": "Sanmen",
                  "size": 2314,
                  "age": 4.5
                },
                {
                  "name": "Taishan",
                  "size": 3320,
                  "age": 4.6
                },
                {
                  "name": "Tianwan",
                  "size": 6240,
                  "age": 17.0
                },
                {
                  "name": "Yangjiang",
                  "size": 6000,
                  "age": 9.0
                }
              ]
            },
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Qinshan",
                  "size": 6144,
                  "age": 8.2
                }
              ]
            }
          ]
        },
        {
          "name": "India",
          "children": [
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Kaiga",
                  "size": 808,
                  "age": 53.9
                },
                {
                  "name": "Kakrapar",
                  "size": 404,
                  "age": 22.3
                },
                {
                  "name": "Madras",
                  "size": 410,
                  "age": 39.5
                },
                {
                  "name": "Narora",
                  "size": 404,
                  "age": 33.8
                },
                {
                  "name": "Rajasthan",
                  "size": 995,
                  "age": 42.3
                },
                {
                  "name": "Tarapur",
                  "size": 1280,
                  "age": 9.5
                }
              ]
            },
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Kudankulam",
                  "size": 1864,
                  "age": 30.3
                }
              ]
            },
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Tarapur",
                  "size": 1280,
                  "age": 53.9
                }
              ]
            }
          ]
        },
        {
          "name": "Iran",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Bushehr",
                  "size": 915,
                  "age": 11.7
                }
              ]
            }
          ]
        },
        {
          "name": "Japan",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Genkai",
                  "size": 2254,
                  "age": 36.1
                },
                {
                  "name": "Ikata",
                  "size": 846,
                  "age": 28.2
                },
                {
                  "name": "Mihama",
                  "size": 780,
                  "age": 34.6
                },
                {
                  "name": "Ohi",
                  "size": 2254,
                  "age": 45.0
                },
                {
                  "name": "Sendai",
                  "size": 1692,
                  "age": 28.9
                },
                {
                  "name": "Takahama",
                  "size": 3220,
                  "age": 39.4
                },
                {
                  "name": "Tomari",
                  "size": 1966,
                  "age": 34.1
                },
                {
                  "name": "Tsuruga",
                  "size": 1108,
                  "age": 36.6
                }
              ]
            },
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Higashidori",
                  "size": 1067,
                  "age": 38.1
                },
                {
                  "name": "Kashiwazaki Kariwa",
                  "size": 7965,
                  "age": 30.1
                },
                {
                  "name": "Onagawa",
                  "size": 1592,
                  "age": 29.6
                },
                {
                  "name": "Shika",
                  "size": 1613,
                  "age": 47.0
                },
                {
                  "name": "Shimane",
                  "size": 789,
                  "age": 31.6
                },
                {
                  "name": "Tokai",
                  "size": 1060,
                  "age": 48.8
                }
              ]
            }
          ]
        },
        {
          "name": "Korea",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Hanbit",
                  "size": 5924,
                  "age": 25.9
                },
                {
                  "name": "Hanul",
                  "size": 5924,
                  "age": 36.9
                },
                {
                  "name": "Kori",
                  "size": 2663,
                  "age": 34.9
                },
                {
                  "name": "Shin-Kori I",
                  "size": 1992,
                  "age": 39.8
                },
                {
                  "name": "Shin-Kori Ii",
                  "size": 2834,
                  "age": 12.5
                },
                {
                  "name": "Shin-Wolsong",
                  "size": 1990,
                  "age": 7.0
                }
              ]
            },
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Wolsong",
                  "size": 1764,
                  "age": 11.0
                }
              ]
            }
          ]
        },
        {
          "name": "Pakistan",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Karachi",
                  "size": 1014,
                  "age": 1.8
                }
              ]
            },
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Kanupp",
                  "size": 90,
                  "age": 22.7
                }
              ]
            }
          ]
        },
        {
          "name": "Taiwan, China",
          "children": [
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Kuosheng",
                  "size": 1970,
                  "age": 40.8
                }
              ]
            },
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Maanshan",
                  "size": 1874,
                  "age": 38.8
                }
              ]
            }
          ]
        },
        {
          "name": "U.A.E.",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Barakah",
                  "size": 1417,
                  "age": 2.4
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Europe",
      "children": [
        {
          "name": "Belarus",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Ostrovetskaya",
                  "size": 1110,
                  "age": 2.2
                }
              ]
            }
          ]
        },
        {
          "name": "Belgium",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Doel",
                  "size": 2934,
                  "age": 48.5
                },
                {
                  "name": "Tihange",
                  "size": 3008,
                  "age": 47.9
                }
              ]
            }
          ]
        },
        {
          "name": "Bulgaria",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Kozloduy",
                  "size": 2006,
                  "age": 35.2
                }
              ]
            }
          ]
        },
        {
          "name": "Czechia",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Dukovany",
                  "size": 1878,
                  "age": 37.9
                },
                {
                  "name": "Temelin",
                  "size": 2056,
                  "age": 22.2
                }
              ]
            }
          ]
        },
        {
          "name": "Finland",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Loviisa",
                  "size": 1014,
                  "age": 46.0
                }
              ]
            },
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Olkiluoto",
                  "size": 1780,
                  "age": 44.5
                }
              ]
            }
          ]
        },
        {
          "name": "France",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Belleville",
                  "size": 2620,
                  "age": 35.3
                },
                {
                  "name": "Blayais",
                  "size": 3640,
                  "age": 41.6
                },
                {
                  "name": "Bugey",
                  "size": 3580,
                  "age": 44.7
                },
                {
                  "name": "Cattenom",
                  "size": 5200,
                  "age": 36.2
                },
                {
                  "name": "Chinon",
                  "size": 3620,
                  "age": 40.2
                },
                {
                  "name": "Chooz",
                  "size": 3000,
                  "age": 26.5
                },
                {
                  "name": "Civaux",
                  "size": 2990,
                  "age": 25.1
                },
                {
                  "name": "Cruas",
                  "size": 3660,
                  "age": 39.8
                },
                {
                  "name": "Dampierre",
                  "size": 3560,
                  "age": 42.8
                },
                {
                  "name": "Flamanville",
                  "size": 2660,
                  "age": 37.3
                },
                {
                  "name": "Golfech",
                  "size": 2620,
                  "age": 32.7
                },
                {
                  "name": "Gravelines",
                  "size": 5460,
                  "age": 42.9
                },
                {
                  "name": "Nogent",
                  "size": 2620,
                  "age": 35.3
                },
                {
                  "name": "Paluel",
                  "size": 5320,
                  "age": 38.7
                },
                {
                  "name": "Penly",
                  "size": 2660,
                  "age": 32.8
                },
                {
                  "name": "St. Alban",
                  "size": 2670,
                  "age": 37.4
                },
                {
                  "name": "St. Laurent",
                  "size": 1830,
                  "age": 42.0
                },
                {
                  "name": "Tricastin",
                  "size": 3660,
                  "age": 42.9
                }
              ]
            }
          ]
        },
        {
          "name": "Germany",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Emsland",
                  "size": 1335,
                  "age": 34.7
                },
                {
                  "name": "Isar",
                  "size": 1410,
                  "age": 35.0
                },
                {
                  "name": "Neckarwestheim",
                  "size": 1310,
                  "age": 34.0
                }
              ]
            }
          ]
        },
        {
          "name": "Hungary",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Paks",
                  "size": 1916,
                  "age": 40.1
                }
              ]
            }
          ]
        },
        {
          "name": "Netherlands",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Borssele",
                  "size": 482,
                  "age": 49.6
                }
              ]
            }
          ]
        },
        {
          "name": "Romania",
          "children": [
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Cernavoda",
                  "size": 1300,
                  "age": 26.7
                }
              ]
            }
          ]
        },
        {
          "name": "Russia",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Balakovo",
                  "size": 3800,
                  "age": 42.9
                },
                {
                  "name": "Kalinin",
                  "size": 3800,
                  "age": 4.9
                },
                {
                  "name": "Kola",
                  "size": 1644,
                  "age": 40.3
                },
                {
                  "name": "Leningrad",
                  "size": 4052,
                  "age": 38.8
                },
                {
                  "name": "Novovoronezh",
                  "size": 1335,
                  "age": 4.9
                },
                {
                  "name": "Novovoronezh-2",
                  "size": 2201,
                  "age": 50.0
                },
                {
                  "name": "Pevek",
                  "size": 64,
                  "age": 6.6
                },
                {
                  "name": "Volgodonsk",
                  "size": 3868,
                  "age": 21.9
                }
              ]
            },
            {
              "name": "FBR",
              "children": [
                {
                  "name": "Beloyarsky",
                  "size": 1380,
                  "age": 48.1
                }
              ]
            },
            {
              "name": "LWGR",
              "children": [
                {
                  "name": "Bilibino",
                  "size": 33,
                  "age": 44.1
                },
                {
                  "name": "Kursk",
                  "size": 3700,
                  "age": 37.1
                },
                {
                  "name": "Leningrad",
                  "size": 4052,
                  "age": 49.5
                },
                {
                  "name": "Smolensk",
                  "size": 2775,
                  "age": 4.2
                }
              ]
            }
          ]
        },
        {
          "name": "Slovakia",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Bohunice V2",
                  "size": 932,
                  "age": 38.4
                },
                {
                  "name": "Mochovce",
                  "size": 936,
                  "age": 24.6
                }
              ]
            }
          ]
        },
        {
          "name": "Slovenia",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Krsko",
                  "size": 688,
                  "age": 41.3
                }
              ]
            }
          ]
        },
        {
          "name": "Spain",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Almaraz",
                  "size": 2017,
                  "age": 38.4
                },
                {
                  "name": "Asco",
                  "size": 1992,
                  "age": 41.8
                },
                {
                  "name": "Trillo",
                  "size": 1003,
                  "age": 34.7
                },
                {
                  "name": "Vandellos",
                  "size": 1045,
                  "age": 35.2
                }
              ]
            },
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Cofrentes",
                  "size": 1064,
                  "age": 39.2
                }
              ]
            }
          ]
        },
        {
          "name": "Sweden",
          "children": [
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Forsmark",
                  "size": 3280,
                  "age": 42.7
                },
                {
                  "name": "Oskarshamn",
                  "size": 1400,
                  "age": 38.0
                }
              ]
            },
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Ringhals",
                  "size": 2202,
                  "age": 42.5
                }
              ]
            }
          ]
        },
        {
          "name": "Switzerland",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Beznau",
                  "size": 730,
                  "age": 38.8
                },
                {
                  "name": "Goesgen",
                  "size": 1010,
                  "age": 53.5
                }
              ]
            },
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Leibstadt",
                  "size": 1220,
                  "age": 44.0
                }
              ]
            }
          ]
        },
        {
          "name": "Ukraine",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Khmelnitski",
                  "size": 1900,
                  "age": 35.1
                },
                {
                  "name": "Rovno",
                  "size": 2657,
                  "age": 42.1
                },
                {
                  "name": "South Ukraine",
                  "size": 2850,
                  "age": 40.1
                },
                {
                  "name": "Zaporozhye",
                  "size": 5700,
                  "age": 38.1
                }
              ]
            }
          ]
        },
        {
          "name": "U.K.",
          "children": [
            {
              "name": "GCR",
              "children": [
                {
                  "name": "Hartlepool",
                  "size": 1185,
                  "age": 39.5
                },
                {
                  "name": "Heysham",
                  "size": 2300,
                  "age": 39.8
                },
                {
                  "name": "Torness",
                  "size": 1200,
                  "age": 27.9
                }
              ]
            },
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Sizewell B",
                  "size": 1198,
                  "age": 34.8
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "North America",
      "children": [
        {
          "name": "Canada",
          "children": [
            {
              "name": "PHWR",
              "children": [
                {
                  "name": "Bruce A",
                  "size": 3090,
                  "age": 46.1
                },
                {
                  "name": "Bruce B",
                  "size": 3268,
                  "age": 38.2
                },
                {
                  "name": "Darlington",
                  "size": 3512,
                  "age": 32.2
                },
                {
                  "name": "Pickering",
                  "size": 3094,
                  "age": 51.9
                },
                {
                  "name": "Point Lepreau",
                  "size": 660,
                  "age": 40.5
                }
              ]
            }
          ]
        },
        {
          "name": "U.S.A.",
          "children": [
            {
              "name": "PWR",
              "children": [
                {
                  "name": "Arkansas One",
                  "size": 1824,
                  "age": 48.4
                },
                {
                  "name": "Beaver Valley",
                  "size": 1813,
                  "age": 46.7
                },
                {
                  "name": "Braidwood",
                  "size": 2354,
                  "age": 35.6
                },
                {
                  "name": "Byron",
                  "size": 2300,
                  "age": 37.9
                },
                {
                  "name": "Callaway",
                  "size": 1215,
                  "age": 38.3
                },
                {
                  "name": "Calvert Cliffs",
                  "size": 1732,
                  "age": 48.3
                },
                {
                  "name": "Catawba",
                  "size": 2310,
                  "age": 38.0
                },
                {
                  "name": "Comanche Peak",
                  "size": 2400,
                  "age": 32.8
                },
                {
                  "name": "Davis Besse",
                  "size": 894,
                  "age": 45.4
                },
                {
                  "name": "Diablo Canyon",
                  "size": 2256,
                  "age": 38.7
                },
                {
                  "name": "Donald Cook",
                  "size": 2198,
                  "age": 48.0
                },
                {
                  "name": "Farley",
                  "size": 1757,
                  "age": 45.4
                },
                {
                  "name": "H.B. Robinson",
                  "size": 741,
                  "age": 52.3
                },
                {
                  "name": "Mcguire",
                  "size": 2316,
                  "age": 41.4
                },
                {
                  "name": "Millstone",
                  "size": 2079,
                  "age": 47.2
                },
                {
                  "name": "North Anna",
                  "size": 1892,
                  "age": 44.8
                },
                {
                  "name": "Oconee",
                  "size": 2554,
                  "age": 49.7
                },
                {
                  "name": "Palo Verde",
                  "size": 3937,
                  "age": 37.6
                },
                {
                  "name": "Point Beach",
                  "size": 1182,
                  "age": 52.2
                },
                {
                  "name": "Prairie Island",
                  "size": 1041,
                  "age": 49.1
                },
                {
                  "name": "R.E. Ginna",
                  "size": 560,
                  "age": 53.2
                },
                {
                  "name": "Salem",
                  "size": 2327,
                  "age": 46.1
                },
                {
                  "name": "Seabrook",
                  "size": 1246,
                  "age": 33.6
                },
                {
                  "name": "Sequoyah",
                  "size": 2291,
                  "age": 42.5
                },
                {
                  "name": "Shearon Harris",
                  "size": 964,
                  "age": 36.0
                },
                {
                  "name": "South Texas",
                  "size": 2560,
                  "age": 34.8
                },
                {
                  "name": "St. Lucie",
                  "size": 1968,
                  "age": 46.7
                },
                {
                  "name": "Surry",
                  "size": 1676,
                  "age": 50.5
                },
                {
                  "name": "Turkey Point",
                  "size": 1658,
                  "age": 50.2
                },
                {
                  "name": "Virgil C. Summer",
                  "size": 973,
                  "age": 40.2
                },
                {
                  "name": "Vogtle",
                  "size": 2302,
                  "age": 35.8
                },
                {
                  "name": "Waterford",
                  "size": 1168,
                  "age": 37.9
                },
                {
                  "name": "Watts Bar",
                  "size": 2321,
                  "age": 27.0
                },
                {
                  "name": "Wolf Creek",
                  "size": 1200,
                  "age": 37.6
                }
              ]
            },
            {
              "name": "BWR",
              "children": [
                {
                  "name": "Browns Ferry",
                  "size": 3610,
                  "age": 49.4
                },
                {
                  "name": "Brunswick",
                  "size": 1870,
                  "age": 46.3
                },
                {
                  "name": "Clinton",
                  "size": 1062,
                  "age": 35.9
                },
                {
                  "name": "Columbia",
                  "size": 1131,
                  "age": 39.0
                },
                {
                  "name": "Cooper",
                  "size": 769,
                  "age": 48.9
                },
                {
                  "name": "Dresden",
                  "size": 1773,
                  "age": 53.0
                },
                {
                  "name": "Enrico Fermi",
                  "size": 1115,
                  "age": 37.6      
                },
                {
                  "name": "Fitzpatrick",
                  "size": 813,
                  "age": 48.2
                },
                {
                  "name": "Grand Gulf",
                  "size": 1401,
                  "age": 40.4
                },
                {
                  "name": "Hatch",
                  "size": 1759,
                  "age": 48.3
                },
                {
                  "name": "Hope Creek",
                  "size": 1172,
                  "age": 36.5
                },
                {
                  "name": "Lasalle",
                  "size": 2277,
                  "age": 40.6
                },
                {
                  "name": "Limerick",
                  "size": 2268,
                  "age": 38.0
                },
                {
                  "name": "Monticello",
                  "size": 628,
                  "age": 52.1
                },
                {
                  "name": "Nine Mile Point",
                  "size": 1890,
                  "age": 53.4
                },
                {
                  "name": "Peach Bottom",
                  "size": 2631,
                  "age": 49.3
                },
                {
                  "name": "Perry",
                  "size": 1240,
                  "age": 36.6
                },
                {
                  "name": "Quad Cities",
                  "size": 1819,
                  "age": 51.2
                },
                {
                  "name": "River Bend",
                  "size": 967,
                  "age": 37.2
                },
                {
                  "name": "Susquehanna",
                  "size": 2514,
                  "age": 40.3
                }
              ]
            }
          ]
        }
      ]
    }
  ]
};

var colorScale = d3.scale.linear()
    .domain([0, 54])
    .range(["#5ca06a", "#ba4444"]);


var circleFill = function(d) {
  if (d['color']) {
    return d.color;
  } else {
    console.log(d.depth);
    console.log(d.children);
    return d.children ? color(d.depth) : colorScale(d.age);
  }
}

var calculateTextFontSize = function(d) {
  return Math.min(1.4 * d.r, (2 * d.r - 8) / this.getComputedTextLength() * 5) + "px";
}

const height = document.querySelector("#chart").parentElement.clientHeight;
const width = document.querySelector("#cardCirclePacking").clientWidth;
console.log(width);

var margin = 20,
  diameter = Math.min(window.innerHeight * 0.8, width * 0.9);

var color = d3.scale.linear()
  .domain([-1, 18])
  .range(["hsl(0,0%,100%)", "hsl(228,30%,40%)"])
  .interpolate(d3.interpolateHcl);

var pack = d3.layout.pack()
  .padding(2)
  .size([diameter - margin, diameter - margin])
  .value(function(d) {
    return d.size;
  })




var svg = d3.select("#chart").append("svg")
  .attr("width", width * 0.9)
  .attr("height", window.innerHeight * 0.8)
  .append("g")
  .attr("transform", "translate(" + width * 0.9/ 2 + "," + diameter / 2 + ")");
console.log("i ran");

var focus = root,
  nodes = pack.nodes(root),
  view;

var circle = svg.selectAll("circle")
  .data(nodes)
  .enter().append("circle")
  .attr("class", function(d) {
    return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root";
  })
  .style("fill", circleFill)
  .on("click", function(d) {
    if (focus !== d) zoom(d), d3.event.stopPropagation();
  });

circle.append("svg:title")
  .text(function(d) {
    return d.name;
  })

var text = svg.selectAll("text")
  .data(nodes)
  .enter().append("text")
  .attr("class", "label")
  .style("fill-opacity", function(d) {
    return d.parent === root ? 1 : 0;
  })
  .style("display", function(d) {
    return d.parent === root ? null : "none";
  })
  .text(function(d) {
    if (d.size) {
      return d.name + '\r\n(' + d.age + ' YO)';
    } else { 
      return d.name;
    }

  })
  .style("font-size", calculateTextFontSize)
  .attr("dy", ".35em");

var node = svg.selectAll("circle,text");

d3.select("#chart")
  .style("background", "transparent")
  .on("click", function() {
    zoom(root);
  });

zoomTo([root.x, root.y, root.r * 2 + margin]);

function zoom(d) {
  var focus0 = focus;
  focus = d;

  var transition = d3.transition()
    .duration(d3.event.altKey ? 7500 : 750)
    .tween("zoom", function(d) {
      var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2 + margin]);
      return function(t) {
        zoomTo(i(t));
      };
    });

  transition.selectAll("#chart text")
    .filter(function(d) {
      return d.parent === focus || this.style.display === "inline";
    })
    .style("fill-opacity", function(d) {
      return d.parent === focus ? 1 : 0;
    })
    .each("start", function(d) {
      if (d.parent === focus) this.style.display = "inline";
    })
    .each("end", function(d) {
      if (d.parent !== focus) this.style.display = "none";
    });
}

function zoomTo(v) {
  var k = diameter / v[2];
  view = v;
  node.attr("transform", function(d) {
    return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")";
  });
  circle.attr("r", function(d) {
    return d.r * k;
  });
}

d3.select(self.frameElement).style("height", diameter + "px");



